name: Code Check

on:
    workflow_call:

jobs:
    build:
        runs-on: ubuntu-latest
        strategy:
            fail-fast: false
        steps:
            - name: Checkout
              uses: actions/checkout@v2
            - name: Setup NodeJs
              uses: actions/setup-node@v1
              with:
                  node-version: "12.x"
            - name: Install client dependencies
              working-directory: ./
              run: yarn install
            - name: Client tests lint
              run: yarn run lint
    release:
        runs-on: ubuntu-latest
        # We specify that deploys needs to
        # finish before we create a release
        needs: deploy
        steps:
            # Download previously shared build
            - name: Get artifact
              uses: actions/download-artifact@v1
              with:
                  name: react-github-actions-build
            # Zip the build using external action
            - name: Zip build
              uses: thedoctor0/zip-release@master
              with:
                  filename: react-github-actions-release-build.zip
                  path: ./next
            # Upload as an artifact of the current workflow
            - name: Upload build zip artifact
              uses: actions/upload-artifact@v1
              with:
                  name: react-github-actions-release-build.zip
                  path: react-github-actions-release-build.zip
